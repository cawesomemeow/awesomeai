document.addEventListener("DOMContentLoaded",function(){function e(e,t){var n=document.createElement("script");n.src=e,n.onload=t,document.head.appendChild(n)}e("https://cdn.jsdelivr.net/npm/marked/marked.min.js",()=>{var e;marked.setOptions({sanitizer:!0,sanitize:!0}),(e=(e=new URLSearchParams(window.location.search)).get("gist"))&&fetch("https://api.github.com/gists/"+e).then(e=>e.json()).then(e=>{e.files&&e.files["chat.json"]?(g=JSON.parse(e.files["chat.json"].content),document.getElementById("messageContainer").innerHTML="",g.forEach(e=>{B(e.content,e.role)}),m.style.display="block",document.querySelector(".previous-chats").style.display="none",a.textContent="Send Message"):console.error("No chat data found for this ID.")}).catch(e=>{console.error("Error loading chat:",e)}),console.log("marked loaded")}),e("https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.2/xlsx.full.min.js",()=>{console.log("xlsx loaded")}),e("https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js",()=>{console.log("mammoth loaded")}),e("https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.min.js",()=>{var e=document.createElement("script");e.innerHTML='pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/2.10.377/pdf.worker.min.js";',document.head.appendChild(e),console.log("pdfjs loaded")}),e("https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js",()=>{console.log("jszip loaded")}),e("https://cdn.jsdelivr.net/npm/epubjs@0.3.88/dist/epub.min.js",()=>{console.log("epubjs loaded")});{const oe=new AbortController,ae=setTimeout(()=>oe.abort(),2e3);fetch("https://api.discord.rocks/models",{method:"GET",signal:oe.signal}).then(e=>{if(clearTimeout(ae),e.ok)return e.json();console.error("API models returned error status:",e.status),document.getElementById("apiStatusMessage").style.display="block"}).then(e=>{if(e){e=e.data.map(e=>e.id);{var t="Other models";const n=document.getElementById("modelDropdown"),o=document.createElement("option");o.textContent=t,o.disabled=!0,o.selected=!0,n.appendChild(o),e.forEach(e=>{var t=document.createElement("option");t.value=e,t.textContent=e,n.appendChild(t)}),n.selectedIndex=1}}}).catch(e=>{document.getElementById("apiStatusMessage").style.display="block","AbortError"===e.name?(console.error("Fetch request timed out."),document.getElementById("apiStatusMessage").textContent="Request to api.discord.rocks timed out."):console.error("Error fetching GPT API data:",e)})}let h=new AbortController;const s=document.getElementById("messageBox"),$=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),i=(s.addEventListener("keydown",function(e){"Enter"!==e.key||$||e.shiftKey||(e.preventDefault(),Y())}),document.getElementById("fileContainer"));let l=[];function M(e){e.preventDefault(),e.stopPropagation()}function O(e){s.style.border="2px dashed #8f564c"}function J(e){s.style.border=""}function n(t){for(let e=0;e<t.length;e++){const o=t[e];var n;l.some(e=>e.name===o.name)?alert(`File "${o.name}" is already attached.`):(n=o.name.split(".").pop().toLowerCase(),["xls","xlsx","csv","docx","pdf","pptx","epub","rtf"].includes(n)?(l.push(o),c(o.name,i)):((n=new FileReader).onload=function(e){var t=new Uint8Array(e.target.result),n=new TextDecoder("utf-8",{fatal:!0});try{n.decode(t),l.push(o),c(o.name,i)}catch(e){alert(`File "${o.name}" is not a supported text, rtf, spreadsheet, docx, pptx, pdf or epub file.`)}},n.onerror=function(e){alert(`Failed to read file: ${o.name}.
`+e.message)},n.readAsArrayBuffer(o.slice(0,100))))}i.style.display="flex",i.style.marginBottom="10px"}function R(o){return new Promise((n,t)=>{var e=new FileReader;e.onload=function(e){var e=new Uint8Array(e.target.result),e=XLSX.read(e,{type:"array"}),t=e.SheetNames[0],e=function(e){if(0===e.length)return"";var t=e[0],n=`| ${t.join(" | ")} |
`,t=`| ${t.map(()=>"---").join(" | ")} |
`,e=e.slice(1).map(e=>`| ${e.join(" | ")} |
`).join("");return n+t+e}(XLSX.utils.sheet_to_json(e.Sheets[t],{header:1}));n(e)},e.onerror=function(e){t(new Error(`Failed to read file "${o.name}": `+e.message))},e.readAsArrayBuffer(o)})}function q(o){return new Promise((t,n)=>{var e=new FileReader;e.onload=function(e){mammoth.extractRawText({arrayBuffer:e.target.result}).then(e=>{t(e.value)}).catch(e=>{n(new Error(`Failed to parse file "${o.name}": `+e.message))})},e.onerror=function(e){n(new Error(`Failed to read file "${o.name}": `+e.message))},e.readAsArrayBuffer(o)})}function H(n){return new Promise((t,o)=>{var e=new FileReader;e.onload=function(e){(new JSZip).loadAsync(e.target.result).then(function(e){const n=[];e.folder("ppt/slides").forEach((e,t)=>{n.push(t.async("string"))}),Promise.all(n).then(e=>{let n="";e.forEach(e=>{var t=(new DOMParser).parseFromString(e,"application/xml").getElementsByTagName("a:t");for(let e=0;e<t.length;e++)n+=t[e].textContent+"\n"}),t(n.trim())}).catch(e=>{o(new Error("Failed to parse slides: "+e.message))})}).catch(e=>{o(new Error("Failed to load ZIP: "+e.message))})},e.onerror=function(e){o(new Error(`Failed to read file "${n.name}": `+e.message))},e.readAsArrayBuffer(n)})}function U(l){return new Promise((i,t)=>{var e=new FileReader;e.onload=async function(e){try{var n=e.target.result,o=new Uint8Array(n),a=await pdfjsLib.getDocument({data:o}).promise;let t="";var r=a.numPages;for(let e=1;e<=r;e++){var s=(await(await a.getPage(e)).getTextContent()).items.map(e=>e.str).join("\n");t+=s+"\n\n"}i(t.trim())}catch(e){t(new Error(`Failed to parse file "${l.name}": `+e.message))}},e.onerror=function(e){t(new Error(`Failed to read file "${l.name}": `+e.message))},e.readAsArrayBuffer(l)})}function W(t){return new Promise((n,o)=>{var e=new FileReader;e.onload=function(e){const t=ePub(e.target.result);t.ready.then(()=>{var e=t.spine.spineItems.map(e=>e.load(t.load.bind(t)).then(()=>e.render()).then(e=>{return(new DOMParser).parseFromString(e,"text/html").body.textContent.trim()}));Promise.all(e).then(e=>{e=e.join("\n\n");n(e)}).catch(e=>{o(new Error("Failed to parse chapters: "+e.message))})}).catch(e=>{o(new Error("Failed to load EPUB: "+e.message))})},e.onerror=function(e){o(new Error(`Failed to read file "${t.name}": `+e.message))},e.readAsArrayBuffer(t)})}function z(e){return e.replace(/\\par[d]?/g,"\n").replace(/\\'[0-9a-f]{2}/gi,e=>String.fromCharCode(parseInt(e.slice(2),16))).replace(/\\[a-z]+\d* ?/gi,"").replace(/[{\\}]/g,"").replace(/\n{2,}/g,"\n")}function c(n,e,o=null){const a=document.createElement("div");a.classList.add("file-bubble");var t=document.createElement("span"),r=(t.textContent=function(e,t=8){var[n,o]=e.split(".");return n.length<=t?e:n.substring(0,t)+"..."+o}(n),document.createElement("button"));r.textContent="Ã—",r.classList.add("close-btn"),r.addEventListener("click",e=>{var t;e.stopPropagation(),t=n,e=a,i.removeChild(e),l=l.filter(e=>e.name!==t),L(s),0===l.length&&(i.style.display="none",i.style.marginBottom="0")}),a.appendChild(r),a.appendChild(t),a.addEventListener("click",()=>{if(o)X(n,o);else{const t=l.find(e=>e.name===n);t&&!function(e){var t=e.name.split(".").pop().toLowerCase();{if(["xls","xlsx","csv"].includes(t))return R(e);if("docx"===t)return q(e);if("pdf"===t)return U(e);if("pptx"===t)return H(e);if("epub"===t)return W(e);if("rtf"===t){const o=new FileReader;return new Promise((t,n)=>{o.onload=function(e){t(z(e.target.result))},o.onerror=function(e){n(e.message)},o.readAsText(e)})}{const a=new FileReader;return new Promise((t,n)=>{a.onload=function(e){t(e.target.result)},a.onerror=function(e){n(e.message)},a.readAsText(e)})}}}(t).then(e=>{X(t.name,e)}).catch(e=>{console.error(`Failed to open file "${n}": `+e.message)})}}),e.appendChild(a)}function X(e,t){const n=document.createElement("div");n.classList.add("modal");var o=document.createElement("div"),a=(o.classList.add("modal-content"),document.createElement("div")),r=(a.classList.add("modal-header"),document.createElement("span")),e=(r.textContent=e,document.createElement("span")),r=(e.classList.add("close"),e.innerHTML="&times;",e.addEventListener("click",()=>{document.body.removeChild(n)}),a.appendChild(r),a.appendChild(e),document.createElement("div"));r.classList.add("modal-body"),r.textContent=t,o.appendChild(a),o.appendChild(r),n.appendChild(o),document.body.appendChild(n),n.addEventListener("click",e=>{e.target===n&&document.body.removeChild(n)})}["dragenter","dragover","dragleave","drop"].forEach(e=>{s.addEventListener(e,M,!1)}),["dragenter","dragover"].forEach(e=>{s.addEventListener(e,O,!1)}),["dragleave","drop"].forEach(e=>{s.addEventListener(e,J,!1)}),s.addEventListener("drop",function(e){e=e.dataTransfer,e=e.files;n(e),L(s)},!1);let d=0;s.addEventListener("paste",function(e){var t=e.clipboardData||window.clipboardData,t=t.getData("Text");t&&500<t.length&&(e.preventDefault(),e=new Blob([t],{type:"text/plain"}),t=new File([e],`paste-${d}.txt`,{type:"text/plain"}),d++,n([t]),L(s))});const G=document.getElementById("attachButton"),_=document.getElementById("fileInput"),a=(G.addEventListener("click",()=>_.click()),_.addEventListener("change",e=>{n(e.target.files),L(s)}),document.getElementById("sendButton")),m=document.getElementById("backButton");var t=document.getElementById("addButton"),o=document.getElementById("runButton"),r=document.getElementById("info-link");const Z=document.getElementById("modelDropdown"),u=document.querySelector(".previous-chats ul");let g=[],p=-1,f=!0;function y(){Y()}function v(){A(),g.push(g.slice(-1)[0]),h.abort(),h=new AbortController,k()}ee(),L(s),t.addEventListener("click",()=>w(s.value.trim())),o.addEventListener("click",function(){document.querySelector(".previous-chats").style.display="none",F(),Q(),a.textContent="Abort",a.removeEventListener("click",y),a.addEventListener("click",v),m.style.display="block",a.className="abort-button"}),a.addEventListener("click",y),m.addEventListener("click",function(){A(),document.getElementById("messageContainer").innerHTML="",document.querySelector(".export-button-container").innerHTML="",g=[],p=-1,m.style.display="none",document.querySelector(".message-form").style.flex="1",document.querySelector(".previous-chats").style.display="block",a.textContent="Start Chat",s.value="",L(s),f=!0}),r.addEventListener("click",function(){confirm("Created by @pianoth, LLMs and domain provided by @meow_18838.\nPowered by the Discord Rocks API (https://api.discord.rocks/) and (https://gpt4.discord.rocks).\n\nDo you want to visit the Discord Rocks API website?")&&(window.location.href="https://api.discord.rocks/")});t=document.getElementById("settingsButton");const b=document.getElementById("settingsModal");o=b.querySelector(".close"),r=document.getElementById("saveSettingsButton");const E=document.getElementById("systemPromptInput"),K=document.getElementById("maxTokensInput");let C=4096,x=(E.addEventListener("input",function(){L(this)}),document.getElementById("maxTokensInput").addEventListener("input",function(){4096<this.value&&(alert("Max tokens cannot exceed 4096."),this.value=4096)}),t.addEventListener("click",function(){E.value=document.getElementById("systemPromptInput").value,K.value=C,b.style.display=""}),o.addEventListener("click",function(){b.style.display="none"}),r.addEventListener("click",function(){document.getElementById("systemPromptInput").value=E.value,C=parseInt(K.value)||4096,b.style.display="none"}),window.addEventListener("click",function(e){e.target===b&&(b.style.display="none")}),s.addEventListener("input",function(){L(this)}),!0);function w(o,r="user"){return new Promise((e,t)=>{if(m.style.display="block",0<l.length){let a="";var n=l.map(o=>new Promise((n,t)=>{var e=o.name.split(".").pop().toLowerCase();["xls","xlsx","csv"].includes(e)?R(o).then(e=>{a+=`
${o.name}
\`\`\`
${e}
\`\`\`
`,n()}).catch(e=>{t(new Error(`Failed to parse file "${o.name}": `+e.message))}):"docx"===e?q(o).then(e=>{e=e.replace(/`/g,"\\`"),a+=`
${o.name}
\`\`\`
${e}
\`\`\`
`,n()}).catch(e=>{t(new Error(`Failed to parse file "${o.name}": `+e.message))}):"pdf"===e?U(o).then(e=>{e=e.replace(/`/g,"\\`"),a+=`
${o.name}
\`\`\`
${e}
\`\`\`
`,n()}).catch(e=>{t(new Error(`Failed to parse file "${o.name}": `+e.message))}):"pptx"===e?H(o).then(e=>{e=e.replace(/`/g,"\\`"),a+=`
${o.name}
\`\`\`
${e}
\`\`\`
`,n()}).catch(e=>{t(new Error(`Failed to parse file "${o.name}": `+e.message))}):"epub"===e?W(o).then(e=>{e=e.replace(/`/g,"\\`"),a+=`
${o.name}
\`\`\`
${e}
\`\`\`
`,n()}).catch(e=>{t(new Error(`Failed to parse file "${o.name}": `+e.message))}):("rtf"===e?((e=new FileReader).onload=function(e){e=z(e.target.result);a+=`
${o.name}
\`\`\`
${e}
\`\`\`
`,n()},e.onerror=function(e){t(new Error(`Failed to read file: ${o.name}.
`+e.message))},e):((e=new FileReader).onload=function(e){let t=e.target.result;t=t.replace(/`/g,"\\`"),a+=`
${o.name}
\`\`\`
${t}
\`\`\`
`,n()},e.onerror=function(e){t(new Error(`Failed to read file: ${o.name}.
`+e.message))},e)).readAsText(o)}));Promise.all(n).then(()=>{d=0,o+=a,l=[],i.style.display="none",i.innerHTML="",g.push({role:r,content:o}),s.value="",L(s),document.querySelector(".previous-chats").style.display="none",F(),B(o,r),A(),e()}).catch(e=>{console.error(e),w("Failed to read attached files.","assistant"),t(e)})}else g.push({role:r,content:o}),s.value="",L(s),document.querySelector(".previous-chats").style.display="none",F(),B(o,r),A(),e()})}function V(e,a){e={model:"gpt-4o",messages:[{role:"system",content:"Create a title for the chat based on the following message or conversation. Output plain text, no markdown."},{role:"user",content:e}],max_tokens:20};const t=new AbortController,n=setTimeout(()=>t.abort(),15e3);fetch("https://api.discord.rocks/ask",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e),signal:t.signal}).then(e=>{if(clearTimeout(n),e.ok)return e.json();console.error("API returned error status:",e.status)}).then(t=>{if(t.response&&0<t.response.length){let e=t.response.trim();e.startsWith('"')&&(e=e.endsWith('"')?e.slice(1,-1):e.slice(1)),t=e,n=a,o=JSON.parse(localStorage.getItem("chats"))||[],n<o.length?(o[n].title=t,localStorage.setItem("chats",JSON.stringify(o)),T()):console.error("Invalid chat index:",n)}var n,o}).catch(e=>{"AbortError"===e.name?console.error("Fetch request for the chat title timed out."):console.error("Error fetching chat title:",e)})}function Y(){let t=s.value.trim();t&&w(t,"user").then(()=>{var e;f&&(e=JSON.parse(localStorage.getItem("chats"))||[],V(t,e.length-1),f=!1),Q(),a.textContent="Abort",a.removeEventListener("click",y),a.addEventListener("click",v),a.className="abort-button"}).catch(e=>{console.error("Error processing files:",e),w("Failed to read attached files.","assistant")})}function Q(){var e=Z.value,t=document.getElementById("systemPromptInput").value.trim(),t={messages:t?[...g.slice(0,-1),{role:"system",content:t},...g.slice(-1)]:g,model:e,max_tokens:C,stream:!0};{var[o,a="https://api.discord.rocks/chat/completions"]=[t];const l=B("Loading...","loading");let n=0,s="",i="";!function t(){m.disabled=!0,h=new AbortController,fetch(a,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o),signal:h.signal}).then(e=>{const o=e.body.getReader(),a=new TextDecoder("utf-8"),r=(l.innerHTML="",document.createElement("span"));r.classList.add("message-content"),l.appendChild(r),o.read().then(function e({done:t,value:n}){t?(document.getElementById("messageContainer").removeChild(l),B(s.trim(),"assistant"),g.push({role:"assistant",content:s.trim()}),A(),k(),m.disabled=!1):(t=a.decode(n,{stream:!0}),n=(i+=t).split("\n\n"),i=n.pop(),n.forEach(t=>{try{var e,n;t.startsWith("data: ")&&"[DONE]"!==(e=t.split("data: ")[1])&&(n=JSON.parse(e)).choices&&n.choices[0].delta&&n.choices[0].delta.content&&(s+=n.choices[0].delta.content,S(r,s),l.className="assistant-message")}catch(e){console.error("Failed to parse event:",e,"Event:",t)}}),o.read().then(e).catch(e=>{"AbortError"===e.name?(document.getElementById("messageContainer").removeChild(l),g.pop(),m.disabled=!1,s.trim()&&(w(s.trim(),"assistant"),A())):console.error("Error:",e)}))})}).catch(e=>{"AbortError"===e.name?x=!1:console.error("Error:",e),n<2&&x?(n++,l.textContent=`Retrying (${n}/2)...`,setTimeout(t,1e3)):(m.disabled=!1,g.pop(),k(),x?(l.textContent="Failed to load response after multiple retries.",l.className="error-message"):(l.parentNode.removeChild(l),s.trim()&&(w(s.trim(),"assistant"),A())))})}()}}function k(){a.textContent="Send Message",a.removeEventListener("click",v),a.addEventListener("click",y),a.className=""}function L(e){e.style.height="auto",e.style.height=e.scrollHeight+"px";var t=0<l.length?"calc(30vh - 60px)":"30vh";e.style.maxHeight=t,document.getElementById("messageBoxContainer").contains(e)&&(e.style.paddingLeft=G.offsetWidth+15+"px")}function S(e,t){e.innerHTML=marked.parse(t).replace(/(?<!<\/?\w+>)\n(?!\s*<\/?\w+>)/g,"<br>"),e.querySelectorAll("pre").forEach(t=>{var e=document.createElement("button");e.textContent="Copy Code",e.className="copy-code-button",e.onclick=function(){var e=t.innerText.slice(0,-11);navigator.clipboard.writeText(e).then(()=>alert("Code copied to clipboard!")).catch(e=>console.error("Failed to copy code: ",e))},t.appendChild(e)})}function I(e,t,n=!0){if(/\n[^\n]+\.\w+\n```\n([\s\S]*?)\n```/g.test(t)&&n){var o,a=e,r=t,s=/\n[^\n]+\.\w+\n```\n([\s\S]*?)\n```/g,n=(a.innerHTML="",r.replace(s,""));for(n.trim()&&(S(o=document.createElement("span"),n.trim()),a.appendChild(o));null!==(l=s.exec(r));){var i=l[0].match(/\n[^\n]+\.\w+/)[0].trim(),l=l[1].trim();c(i,a,l)}}else S(e,t)}function B(e,t){const n=document.createElement("div");n.classList.add("messageDiv"),n.setAttribute("id","message-"+document.getElementById("messageContainer").children.length),n.style.flexDirection="column",n.style.alignItems="center";var o=document.createElement("span"),a=(o.classList.add("message-content"),n.appendChild(o),document.createElement("div")),r=(a.className="message-buttons",document.createElement("button")),s=(r.textContent="Edit",r.className="edit-button",r.title="Edit this message.",r.setAttribute("aria-describedby","editButtonDesc"),document.createElement("button")),i=(s.textContent="Delete",s.className="delete-button",s.title="Delete this message.",s.setAttribute("aria-describedby","deleteButtonDesc"),document.createElement("button"));return i.textContent="Copy",i.className="copy-button",i.title="Copy this message to the clipboard.",i.setAttribute("aria-describedby","copyButtonDesc"),a.appendChild(r),a.appendChild(s),a.appendChild(i),n.className="user"===t?"user-message":"assistant"===t?"assistant-message":"loading-message",document.getElementById("messageContainer").appendChild(n),setTimeout(()=>{n.getBoundingClientRect(),n.scrollIntoView({behavior:"smooth",block:"center"})},0),"loading"!==t?(I(o,e,"user"===t),n.appendChild(a),function s(i,l,c,d,m,t,u){const p="user-message"===m.className;if(1e3<t.length){const e=t.substring(0,1e3)+"...",n=(I(d,e,p),document.createElement("button"));n.textContent="Show More",n.className="show-more-button",n.title="Show the full content of this message.",n.setAttribute("aria-describedby","showMoreButtonDesc"),m.appendChild(n),n.onclick=function(){"Show More"===n.textContent?(I(d,t,p),n.textContent="Show Less",n.title="Collapse the content of this message.",n.setAttribute("aria-describedby","showLessButtonDesc")):(I(d,e,p),n.textContent="Show More",n.title="Show the full content of this message.",n.setAttribute("aria-describedby","showMoreButtonDesc"))}}else I(d,t,p);i.onclick=function(){x=!1,h.abort();let t=parseInt(m.id.split("-")[1]);if(-1!==t){const a=document.createElement("textarea");a.style.width="100%",a.value=g[t].content,setTimeout(()=>{L(a)},0),a.addEventListener("input",function(){L(this)});var n=document.createElement("button"),o=(n.textContent="Confirm",n.className="confirm-button",n.title="Confirm the changes.",n.setAttribute("aria-describedby","confirmButtonDesc"),document.createElement("button"));o.textContent="Cancel",o.className="cancel-button",o.title="Cancel the changes.",o.setAttribute("aria-describedby","cancelButtonDesc"),m.replaceChild(a,d),u.innerHTML="";const r=m.querySelector(".show-more-button");let e=null!==r;e&&m.removeChild(r),u.appendChild(n),u.appendChild(o),n.onclick=function(){g[t]?g[t].content=a.value:g.push({role:"user",content:a.value}),I(d,a.value,p),m.replaceChild(d,a),u.innerHTML="",u.appendChild(i),u.appendChild(l),u.appendChild(c),A(),s(i,l,c,d,m,a.value,u)},o.onclick=function(){m.replaceChild(d,a),u.innerHTML="",u.appendChild(i),u.appendChild(l),u.appendChild(c),e&&m.appendChild(r)}}},l.onclick=function(){confirm("Are you sure you want to delete this message?")&&(h.abort(),document.getElementById("messageContainer").removeChild(m),g=g.filter(e=>e.content!==t),A())},c.onclick=function(){navigator.clipboard.writeText(t).then(()=>alert("Message copied to clipboard!")).catch(e=>console.error("Failed to copy text: ",e))}}(r,s,i,o,n,e,a)):o.textContent=e,n}function A(){var e,t=JSON.parse(localStorage.getItem("chats"))||[];-1===p||p>=t.length?(e={timestamp:(new Date).toISOString(),title:"Chat on "+(new Date).toLocaleString(),conversation:g},t.push(e),p=t.length-1):t[p].conversation=g,localStorage.setItem("chats",JSON.stringify(t)),T()}function ee(){var t=JSON.parse(localStorage.getItem("chats"))||[];u.innerHTML="";for(let e=t.length-1;0<=e;e--)!function(e,o){var t=document.createElement("li"),e=(t.textContent=""+(e.title||"Untitled"),document.createElement("button")),n=(e.textContent="Edit Title",e.title="Edit the title of the chat.",e.setAttribute("aria-describedby","editTitleButtonDesc"),e.onclick=function(e){e.stopPropagation();var t,e=o,n=prompt("Enter new title for the chat:");n&&(t=JSON.parse(localStorage.getItem("chats")))&&t.length>e&&(t[e].title=n,localStorage.setItem("chats",JSON.stringify(t)),T())},document.createElement("button"));n.textContent="Delete",n.title="Delete the chat.",n.setAttribute("aria-describedby","deleteChatButtonDesc"),n.onclick=function(e){e.stopPropagation();var t,e=o;confirm("Are you sure you want to delete this chat?")&&(t=JSON.parse(localStorage.getItem("chats")))&&t.length>e&&(t.splice(e,1),localStorage.setItem("chats",JSON.stringify(t)),T())},t.appendChild(e),t.appendChild(n),t.onclick=()=>{var e=o;if(f=!1,(t=JSON.parse(localStorage.getItem("chats")))&&t.length>e){var t=t[e],n=(g=t.conversation,p=e,document.getElementById("messageContainer").innerHTML="",g.forEach(e=>{B(e.content,e.role)}),document.getElementById("messageContainer").children);for(let e=0;e<n.length;e++)n[e].setAttribute("id","message-"+e);m.style.display="block",document.querySelector(".previous-chats").style.display="none",F(),a.textContent="Send Message",s.value="",L(s)}},u.appendChild(t)}(t[e],e)}function T(){u.innerHTML="",ee()}function F(){var e=document.querySelector(".export-button-container");e.innerHTML||(e.innerHTML=`
            <button id="exportChatButton" class="export-button" title="Export the current chat as a text file." aria-describedby='exportChatDesc'>Export chat</button>
            <button id="shareChatButton" class="export-button" title="Create a shareable link to the current chat." aria-describedby='shareChatDesc'>Share chat</button>
        `,document.getElementById("exportChatButton").onclick=function(){var e=JSON.parse(localStorage.getItem("chats")),t=function(e){var n=JSON.parse(localStorage.getItem("chats"));if(n&&n.length>e){n=n[e];let t="";return n.conversation.forEach(e=>{t+=`*${e.role}* : ${e.content}

---

`}),t.substring(0,t.length-7)}}(p),t=new Blob([t],{type:"text/plain"}),t=URL.createObjectURL(t),n=document.createElement("a");n.href=t,n.download=`${e[p].title||"Untitled"}.txt`,n.click(),URL.revokeObjectURL(t)},document.getElementById("shareChatButton").onclick=function(){var e;confirm("Warning: Do not share sensitive data. The only way to un-share the chat is to contact @pianoth and sending the chat link to be removed.\n\nDo you want to create a public link for this chat?")&&(e=g,fetch("https://api.github.com/gists",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"token "+te},body:JSON.stringify({description:"LLM Playground Chat",public:!0,files:{"chat.json":{content:JSON.stringify(e)}}})}).then(e=>e.json()).then(e=>{var t;e.id?(t=""+window.location.origin+window.location.pathname+"?gist="+e.id,confirm("Shareable link created: "+t+"\n\nDo you want to copy the URL to the clipboard?")&&navigator.clipboard.writeText(t).then(()=>alert("Link copied to clipboard.")).catch(e=>console.error("Failed to copy link: ",e))):console.error("Failed to save chat data:",e)}).catch(e=>{console.error("Error:",e)}))})}const te=function(e){try{return atob(e)}catch(e){return console.error("Failed to decode Base64 string:",e),""}}("azFaTWlKNDBMeXhtMFQzMmZxcW4yYXlkOGxpWnJPT0VZbEhWNEtfcGhneDk=").split("").reverse().join("").slice(2,-2);const j=document.createElement("textarea"),D=(j.id="searchTextarea",j.placeholder="Search chats...",document.querySelector(".previous-chats-controls").appendChild(j),document.getElementById("searchButton")),N=document.getElementById("exportDataButton"),P=document.getElementById("importDataButton"),ne=document.getElementById("deleteDataButton");D.addEventListener("click",function(){"block"===j.style.display?(j.style.display="none",j.value="",D.textContent="Search",N.style.display="inline",P.style.display="inline",ne.style.display="inline",document.querySelectorAll(".previous-chats li").forEach(e=>e.style.display="list-item")):(j.style.display="block",D.textContent="Close Search",N.style.display="none",P.style.display="none",ne.style.display="none")}),j.addEventListener("input",function(){const o=j.value.toLowerCase(),a=JSON.parse(localStorage.getItem("chats"))||[];document.querySelectorAll(".previous-chats li").forEach((e,t)=>{var t=a.length-1-t,t=a[t],n=t.title.toLowerCase(),t=t.conversation.map(e=>e.content.toLowerCase()).join(" ");n.includes(o)||t.includes(o)?e.style.display="list-item":e.style.display="none"})}),N.addEventListener("click",function(){var e;confirm("Do you want to export the chats to the clipboard?")&&((e=localStorage.getItem("chats"))?navigator.clipboard.writeText(e).then(()=>alert("Chats exported to clipboard.")).catch(e=>console.error("Failed to copy chats: ",e)):alert("No chats available to export."))}),P.addEventListener("click",function(){confirm("Do you want to import chats from the clipboard? You need to click the paste button after this confirming. This will overwrite existing chats.")&&navigator.clipboard.readText().then(e=>{try{var t=JSON.parse(e);Array.isArray(t)?(localStorage.setItem("chats",JSON.stringify(t)),T(),alert("Chats imported successfully.")):alert("Invalid chat data.")}catch(e){console.error("Failed to parse imported chats: ",e),alert("Failed to import chats.")}}).catch(e=>console.error("Failed to read from clipboard: ",e))}),ne.addEventListener("click",function(){confirm("Do you want to delete all chats?")&&(localStorage.removeItem("chats"),T(),alert("All chats deleted."))}),document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.classList.toggle("light-mode"),document.body.classList.contains("light-mode")?(localStorage.setItem("theme","light"),document.body.style.backgroundColor="#f1f1f1",document.documentElement.style.backgroundColor="#f1f1f1"):(localStorage.removeItem("theme"),document.body.style.backgroundColor="#333",document.documentElement.style.backgroundColor="#333")}),localStorage.getItem("theme")&&(document.body.classList.add("light-mode"),document.body.style.backgroundColor="#f1f1f1",document.documentElement.style.backgroundColor="#f1f1f1")});
